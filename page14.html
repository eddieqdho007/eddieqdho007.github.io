<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz 40 Questions</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6eb0f1;
            --correct-color: #4CAF50;
            --incorrect-color: #f44336;
            --warning-color: #ff9800;
            --text-color: #1a1a1a;
            --light-gray: #f5f5f5;
            --border-color: rgba(0, 0, 0, 0.4);
            --header-height: 40px;
            --footer-height: 40px;
            --base-font-size: 20px;
            --mobile-font-size: 18px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Noto Sans KR', Arial, sans-serif;
            font-size: var(--base-font-size);
            color: var(--text-color);
        }

        .header-bar {
            display: grid;
            grid-template-columns: 30% 20% 5% 25% 5% 15%;
            position: fixed;
            top: 0;
            width: 100%;
            height: var(--header-height);
            background-color: white;
            text-align: center;
            font-size: var(--base-font-size);
            color: black;
            border-bottom: 1px solid var(--border-color);
            z-index: 999;
        }

        .header-bar div {
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid var(--border-color);
        }

        .header-bar div:nth-child(1),
        .header-bar div:nth-child(2),
        .header-bar div:nth-child(4) {
            background-color: #0000001a;
        }

        .header-bar div:nth-child(1) {
            border-left: 1px solid var(--border-color);
        }

        .header-bar div:nth-child(3) {
            background-color: #84afbd;
        }

        .header-bar div:nth-child(5) {
            background-color: #e47a6e;
        }

        .header-bar div:nth-child(6) {
            background-color: var(--primary-color);
        }

        .container {
            display: grid;
            grid-template-columns: 55% 45%;
            margin-top: var(--header-height);
            height: calc(100vh - var(--header-height) - var(--footer-height));
        }

        .soal {
            padding: 5px;
            padding-left: 25px;
            overflow-y: auto;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            background-color: white;
            font-size: var(--base-font-size);
        }
        
        .jawaban {
            padding: 5px;
            overflow-y: auto;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            background-color: white;
            font-size: var(--base-font-size);
        }

        .pertanyaan {
            padding: 5px;
            display: none;
        }

        .pertanyaan.active {
            display: block;
        }

        .pertanyaan img,
        .jawaban-gambar,
        .review-image {
            display: block;
            max-width: 50%;
            height: auto;
            margin: 15px auto;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .pertanyaan img:hover,
        .jawaban-gambar:hover,
        .review-image:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            touch-action: none;
        }

        .zoom-area {
            width: 100%;
            height: 100%;
            overflow: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
        }

        .zoom-area img {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            transition: transform 0.25s ease;
        }

        .btn-tutup {
            position: absolute;
            top: 16px;
            right: 20px;
            background-color: #fff;
            color: #000;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10000;
        }

        .jawaban-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .jawaban-item:last-child {
            border-bottom: none;
        }

        .lingkaran {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: white;
            color: black;
            border: 1px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .jawaban-item.selected .lingkaran {
            background-color: black;
            color: white;
        }

        .teks-jawaban {
            flex-grow: 1;
            white-space: normal;
            overflow-wrap: break-word;
            min-width: 0;
            font-size: var(--base-font-size);
        }

        .footer-button {
            display: flex;
            justify-content: space-between;
            background-color: #ffffff;
            border-top: 1px solid var(--border-color);
            position: fixed;
            bottom: 0;
            width: 100%;
            height: var(--footer-height);
        }

        .footer-button button {
            flex: 1;
            max-width: 200px;
            height: 100%;
            font-size: 17px;
            border: none;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            background-color: #0000001a;
            color: black;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .footer-button button:hover {
            background-color: #00000063;
        }

        .footer-button button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .footer-button .tengah {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            cursor: pointer;
            padding-left: 10px;
            padding-right: 10px;
        }

        .pertanyaan h3,
        .pertanyaan p,
        .teks-jawaban,
        .lingkaran,
        .deskripsi-soal {
            font-size: var(--base-font-size);
            line-height: 1.4;
        }

        .pertanyaan h3 {
            margin: 10px;
            margin-bottom: 20px;
        }

        .pertanyaan p {
            margin: 10px;
            line-height: 1.5;
        }

        .deskripsi-soal {
            line-height: 1.5;
            margin: 10px;
            background-color: white;
        }

        .text-box,
        .text-box-2 {
            display: block;
            max-width: 80%;
            margin: 15px auto;
            padding: 15px;
            background-color: white;
            border: 1px solid #cacaca;
            font-size: var(--base-font-size);
            line-height: 1.5;
        }

        .text-box-2 {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .audio-container,
        .audio-control {
            display: none;
            text-align: center;
            margin: 15px auto;
            max-width: 200px;
            overflow: hidden;
        }

        .custom-audio-player,
        .jawaban-audio-player {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px auto;
            gap: 10px;
        }

        .custom-audio-player button,
        .jawaban-audio-player button,
        .review-audio-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .custom-audio-player button:disabled,
        .jawaban-audio-player button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .custom-audio-player button img,
        .jawaban-audio-player button img,
        .review-audio-btn img {
            width: 100%;
            height: 100%;
            border: 2px solid rgb(22, 31, 170);
            border-radius: 10px;
        }

        .audio-icon {
            width: 80px;
            height: 80px;
            border: 2px solid rgb(22, 31, 170);
            border-radius: 15px;
            box-sizing: border-box;
            overflow: hidden;
            padding: 5px;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .jawaban-item .jawaban-content {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .jawaban-gambar {
            max-width: 100px;
            max-height: 60px;
            border-radius: 4px;
        }

        .jawaban-audio-player {
            justify-content: flex-start;
            margin-left: 10px;
        }

        .jawaban-audio-player button {
            width: 60px;
            height: 60px;
        }

        .jawaban-audio-player button img {
            border-radius: 10px;
        }

        .review-question {
            margin: 30px 50px;
            padding: 70px;
            border: 1px solid #2c2c2c;
            border-radius: 8px;
            background-color: white;
            font-size: var(--base-font-size);
        }

        .review-option-content {
            font-size: var(--base-font-size);
            line-height: 1.5;
        }

        .review-question-content {
            margin-bottom: 15px;
            font-size: var(--base-font-size);
        }

        .review-options {
            margin-top: 15px;
            font-size: var(--base-font-size);
        }

        .review-option {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: var(--base-font-size);
        }

        .review-option.correct {
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .review-option.user-selected {
            background-color: #FFEBEE;
        }

        .review-option.correct.user-selected {
            background-color: #E8F5E9;
        }

        .review-option-number {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            background-color: #f5f5f5;
            font-size: var(--base-font-size);
        }

        .review-option.correct .review-option-number,
        .review-option.correct.user-selected .review-option-number {
            background-color: var(--correct-color);
            color: white;
            font-size: var(--base-font-size);
        }

        .review-option.user-selected .review-option-number {
            background-color: var(--incorrect-color);
            color: white;
            font-size: var(--base-font-size);
        }

        .review-audio-btn {
            width: 60px;
            height: 60px;
            margin: 0 20px;
        }

        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }

        .result-content {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-result-btn {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .audio-transcript {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-left: 3px solid var(--primary-color);
            font-size: 18px;
            line-height: 1.5;
            color: #333;
            border-radius: 0 4px 4px 0;
        }

        .custom-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100000;
        }

        .custom-dialog-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .custom-dialog-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .custom-dialog-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .custom-dialog-confirm {
            background-color: var(--primary-color);
            color: white;
        }

        .custom-dialog-cancel {
            background-color: var(--incorrect-color);
            color: white;
        }

        .progress-container {
            transition: background-color 0.3s;
            cursor: pointer;
        }

        .progress-container:hover {
            background-color: #ccc;
        }

        .progress-bar {
            transition: width 0.1s linear;
        }

        .audio-player-container {
            width: 100%;
            margin-top: 8px;
        }

        .progress-container {
            width: 100%;
            height: 4px;
            background-color: #ddd;
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            margin-bottom: 4px;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        .time-container {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
        }

        .current-time {
            font-weight: bold;
        }

        .question-list-container {
            width: 90%;
            max-width: 800px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin: 20px auto;
        }

        .question-list-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .question-list-btn {
            width: 100%;
            height: 40px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: var(--light-gray);
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .question-list-btn:hover {
            background-color: #e0e0e0;
        }

        .question-list-btn.current {
            background-color: var(--primary-color);
            color: white;
        }

        .question-list-btn.answered {
            background-color: var(--correct-color);
            color: white;
        }

        .question-list-btn.unanswered {
            background-color: var(--incorrect-color);
            color: white;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 50% 50%;
            }
        }

        @media (max-width: 992px) {
            .header-bar {
                font-size: 16px;
            }

            .pertanyaan img,
            .jawaban-gambar,
            .review-image {
                max-width: 70%;
            }
        }

        @media (max-width: 768px) {
            :root {
                --base-font-size: 18px;
            }

            .container {
                grid-template-columns: 100%;
                grid-template-rows: 1fr 1fr;
                height: calc(100vh - var(--header-height) - var(--footer-height));
            }

            .soal,
            .jawaban {
                height: 50%;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 5px;
            }

            .footer-button button {
                font-size: var(--mobile-font-size);
                max-width: 150px;
            }

            .review-question {
                margin: 20px;
                padding: 30px;
            }

            .question-list-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .pertanyaan img,
            .jawaban-gambar,
            .review-image {
                max-width: 80%;
            }
        }

        @media (max-width: 576px) {
            :root {
                --header-height: 50px;
                --footer-height: 50px;
            }

            .header-bar {
                grid-template-columns: 25% 20% 10% 25% 10% 10%;
                font-size: 14px;
                height: var(--header-height);
            }

            .container {
                margin-top: var(--header-height);
                height: calc(100vh - var(--header-height) - var(--footer-height));
            }

            .soal,
            .jawaban {
                height: 50%;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 5px;
            }

            .footer-button button {
                font-size: 14px;
                max-width: 120px;
            }

            .question-list-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .pertanyaan img,
            .jawaban-gambar,
            .review-image {
                max-width: 90%;
            }

            .text-box,
            .text-box-2 {
                max-width: 95%;
                padding: 10px;
            }
        }

        @media screen and (orientation: landscape) and (max-width: 992px) {
            .container {
                grid-template-columns: 55% 45%;
                grid-template-rows: 1fr;
                height: calc(100vh - var(--header-height) - var(--footer-height));
            }

            .soal,
            .jawaban {
                height: 100%;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .soal {
                padding-right: 5px;
            }

            .jawaban {
                padding-left: 5px;
            }

            .pertanyaan img,
            .jawaban-gambar,
            .review-image {
                max-width: 80%;
            }

            .text-box,
            .text-box-2 {
                max-width: 90%;
            }
        }

        @media screen and (orientation: portrait) and (max-width: 768px) {
            .container {
                grid-template-columns: 100%;
                grid-template-rows: 1fr 1fr;
                height: calc(100vh - var(--header-height) - var(--footer-height));
            }

            .soal,
            .jawaban {
                height: 50%;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 5px;
            }
        }

        @media screen and (min-width: 993px) {
            :root {
                --base-font-size: 24px;
                --heading-scale: 1.4;
            }

            body {
                font-size: var(--base-font-size);
                line-height: 1.7;
            }

            .review-question {
                max-width: 1000px;
                margin: 40px auto;
                padding: 40px;
            }

            .pertanyaan h3 {
                font-size: calc(var(--base-font-size));
                margin-bottom: 30px;
            }

            .pertanyaan p {
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .deskripsi-soal {
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .text-box,
            .text-box-2 {
                font-size: calc(var(--base-font-size) * 1.1);
                padding: 20px;
            }

            .teks-jawaban {
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .jawaban {
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .footer-button button {
                font-size: calc(var(--base-font-size) * 0.9);
            }

            .lingkaran {
                font-size: calc(var(--base-font-size) * 0.9);
                width: 40px;
                height: 40px;
            }

            .review-question-content,
            .review-option-content {
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .review-option {
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .audio-transcript {
                font-size: 20px;
            }
        }

        u {
            text-decoration: underline;
        }

        b,
        strong {
            font-weight: 700 !important;
        }
    </style>
</head>

<body>
    <div class="overlay" id="zoomOverlay">
        <button class="btn-tutup" onclick="tutupZoom()">✕</button>
        <div class="zoom-area">
            <img id="gambarZoom" src="" alt="Zoom Gambar">
        </div>
    </div>

    <div class="header-bar">
        <div>Reading (20 Questions)</div>
        <div>Whole Questions</div>
        <div>40</div>
        <div>Remaining Questions</div>
        <div>40</div>
        <div>50 : 00</div>
    </div>

    <div class="container">
        <div class="soal"></div>
        <div class="jawaban"></div>
    </div>

    <div class="footer-button">
        <button onclick="prevQuestion()">Previous Question</button>
        <button class="tengah" onclick="showQuestionList()">Question <span id="current-question">1</span> of 40</button>
        <button onclick="nextQuestion()">Next Question</button>
    </div>

    <script src="https://unpkg.com/@panzoom/panzoom@9.4.0/dist/panzoom.min.js"></script>
    <script>

        let panzoomInstance;
        let currentQuestion = 1;
        const totalQuestions = 40;
        let remainingQuestions = 40;
        let timerInterval;
        let timeLeft = 50 * 60;
        let hasShownFiveMinuteWarning = false;
        const timerDisplay = document.querySelector('.header-bar div:nth-child(6)');
        let quizData = {};
        let currentReviewAudio = null;
        let currentReviewAudioButton = null;
        let currentProgressContainer = null;
        let currentTimeDisplay = null;
        let durationDisplay = null;
        let currentProgressBar = null;
        let currentAudio = null;
        let audioPlayCounts = {};
        let jawabanAudioPlayCounts = {};
        const correctAnswers = {};
        const userAnswers = {};
        let score = 0;
        const audioTranscripts = {

            "21": "피자.",

            "22": "창문을 닫으세요.",

            "23": "가 : 이건 뭐예여?<br>나 : 마두 씨의 가족 사진이에요.",

            "24": "남 : 자야 씨는 무슨 계절을 좋아해요.<br>여 : 저는 여름을 좋아해요.",

            "25": "이것은 무엇입니까?",
            "25-0": "땅콩입니다",
            "25-1": "호두입니다",
            "25-2": "벼입니다",
            "25-3": "보리입니다",

            "26": "여기는 어디입니까 ?",
            "26-0": "지하철입니다",
            "26-1": "휴게실입니다",
            "26-2": "대합실입니다",
            "26-3": "사무실입니다",

            "27": "이 사람은 무엇을 하고 있습니까?",
            "27-0": "고추를 타고 있습니다",
            "27-1": "파종을 옮기고 있습니다",
            "27-2": "감자를 캐고 있습니다",
            "27-3": "거름을 주고 있습니다",

            "28": "나무가 얼마나 있습니까?",
            "28-0": "5 자루 있습니다",
            "28-1": "6 자루 있습니다",
            "28-2": "5 그루 있습니다",
            "28-3": "6 그루 있습니다",

            "29": "은행은 어디에 있습니까 ?",
            "29-0": "주유소 옆에 있습니다",
            "29-1": "초등학교 앞에 있습니다",
            "29-2": "버스정류장 맞은편에 있습니다",
            "29-3": "편의점 뒤에 있습니다",

            "30": "주차장에 가려고 하는데 어떻게 가는지 아세요?",

            "31": "칼로 씨, 새 작업복이 마음에 들어요?",

            "32": "일을 아주 잘하네요?",

            "33": "새로운 직원은 어때요?",

            "34": "날씨가 많이 더워졌는데 운동하기가 힘들지 않아?",

            "35": "아침을 먹지 않고 출근을 하니까 기운도 없고 힘들어요.",

            "36": "여 : 배추 한 통에 얼마예요?<br>남 : 한 통에 3,000 원이에요<br>여 : 여기 오이는 어떻게 해요?<br>남 : 오이는 2 개에 1,500 원이에요.<br>여 : 오이가 비싸네요. 좀 깎아 주세요. <br>남 : 오이는 1,000 원만 주세요.<br>여 : 고마워요. 그럼 배추 2 통 하고 외 2 개 주세요.",

            "37": "여 : 안녕하세요, 김 민수 씨 맞으세요.<br>남 : 네, 제가 김 민수입니다. 사진보다 더 예쁘시네요.",

            "38": "여 : 오늘 날씨가 참 좋군요. 민수 씨는 주말에 뭐 했어요?<br>남 : 하루 종일 집에만 있었어요.<br>여 : 왜요? 친구를 만나지 않고요.<br>남 : 친구들은 다 여자 친구가 있어서 주말에 저랑 놀 시간이 없어요. 저만 여자 친구가 없으니까 너무 외로워요.<br>여 : 그래요? 그러면 교환 학생 동아리에 한번 가 보는 게 어때요? 여러 나라에서 온 친구들을 많이 만날 수 있을 거예요.<br>남 : 좋을 생각이네요. 집에 가서 한번 알아봐야겠어요.",

            "39": "여 : 통장하고 체크 카드를 만들려고 왔는데요.<br>남 : 신분증과 도장, 거주지 증명 서류를 가지고 오셨어요?<br>여 : 네, 그런데 도장이 없는데요.<br>남 : 그럼 서명도 괜찮습니다. 먼저 이 서류를 작성해 주세요.<br>여 : 그리고 모바일 뱅킹도 이용하고 싶은데 어떻게 해야 돼요?<br>남 : 휴대 전화에 은행 앱을 다운로드하면 이용할 수 있어요.",

            "40": "여 : 오늘은 집에서 깨끗하게 빨래를 하는 방법을 알려 드리겠습니다. 물은 30 °에서 40 ° 사이에 따뜻한 물을 사용해야 합니다. 검은색 옷을 세탁할 때는 소금을 2 숟가락 넣고 소금 물에 빨면 색이 변하지 않습니다. 그리고 하얀 운동화는 치약을 이용하면 더 하얗게 세탁할 수 있습니다. 지금까지 오늘의 생활 정보였습니다.",
        };

        async function loadAudioTranscripts() {
            try {
                const response = await fetch('audio-transcripts.json');
                if (!response.ok) throw new Error('Failed to load audio transcripts');
                audioTranscripts = await response.json();
            } catch (error) {
                console.error('Error loading audio transcripts:', error);
                audioTranscripts = {};
            }
        }

        async function loadQuizData() {
            try {
                const response = await fetch('quiz-data.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                quizData = await response.json();
                initializeQuiz();
            } catch (error) {
                console.error("Gagal memuat quiz-data.json:", error);
                useFallbackData();
            }
        }

        function useFallbackData() {
            quizData = {
                questions: Array.from({ length: 40 }, (_, i) => ({
                    id: i + 1,
                    section: i < 20 ? "Reading" : "Listening",
                    question: `Question ${i + 1} (${i < 20 ? "Reading" : "Listening"})`,
                    description: `This is a sample question for number ${i + 1}`,
                    options: ["Option 1", "Option 2", "Option 3", "Option 4"],
                    correctAnswer: i % 4
                }))
            };

            quizData.questions[0] = {
                id: 1,
                section: "Reading",
                question: "[1 – 4] 다음 질문에 답하십시오.",
                description: "1. 다음 중 밑줄 친 부분이 맞는 문장을 고르십시오.",
                options: ["<p>극장이 어디 <u>있자고 했어요.</u></p>", "<p>언제친구를 <u>만났느냐고 했어요.</u></p>", "<p>뭘로 먼지를 <u>털었다고 했어요.</u></p>", "<p>몇 시에 공연이 <u>시잗하라고 했어요.</u></p>"],
                correctAnswer: 1
            };

            quizData.questions[1] = {
                id: 2,
                section: "Reading",
                question: "",
                description: "2. 다음 내용과 관계있는 그림을 고르십시오.",
                textBox2: "작업을 하기 전에 먼저 환기 장치를 켜세요.",
                options: [
                    { type: 'image', value: 'image/2_1_p14.png' },
                    { type: 'image', value: 'image/2_2_p14.png' },
                    { type: 'image', value: 'image/2_3_p14.png' },
                    { type: 'image', value: 'image/2_4_p14.png' }
                ],
                correctAnswer: 1
            };

            quizData.questions[2] = {
                id: 3,
                section: "Reading",
                question: "",
                description: "3. 다음에 그래프에 대한 설면으로 맞지 않는 것은 무엇입니까 ?",
                image: "image/3_p14.png",
                options: ["화재 예방 교육은 평일에 있습니다.", "화재 예방 교육은 10 시에 시작합니다.", "신입 사원은 교육을 듣지 않아도 됩니다.", "2 층 회의실에서 화재 예방 교육을 합니다."],
                correctAnswer: 2
            };

            quizData.questions[3] = {
                id: 4,
                section: "Reading",
                question: "",
                description: "4. 직장인들이 회사 생활에 적응하기 위해 하는 일에 대한 설명으로 맞는 것은 무엇입니까?",
                image: "image/4_p14.png",
                options: ["인사 잘하기라고 답한 직장인이 가장 많습니다.", "일찍 출근하기라고 답한 직장인이 절반을 넘습니다.", "회식 참석하기라고 답한 직장인이 두 번째로 많습니다.", "직장 내 동호회 활동하기라고 답한 직장인이 가장 적습니다."],
                correctAnswer: 3
            };

            quizData.questions[4] = {
                id: 5,
                section: "Reading",
                question: "[5 – 6] 다음 그림을 보고 맞는 단어나 문장을 고르십시오.",
                description: "5.",
                image: "image/5_p14.png",
                options: ["사과가 맛있어 보입니다.", "사과가 싱싱해 보입니다.", "사과사 상해 보입니다.", "사과가 비싸 보입니다."],
                correctAnswer: 2
            };

            quizData.questions[5] = {
                id: 6,
                section: "Reading",
                question: "",
                description: "6.",
                image: "image/6_p14.png",
                options: ["치료를 받고 있습니다.", "처방을 하고 있습니다.", "체온을 재고 있습니다.", "엑스레이를 찍고 있습니다."],
                correctAnswer: 3
            };

            quizData.questions[6] = {
                id: 7,
                section: "Reading",
                question: "[7 – 8] 다음 질문에 답하십시오.",
                description: "7. 다음 단어와 관계있는 것은 고르십시오.",
                textBox2: "식사",
                options: ["먹다", "막다", "묵다", "하다"],
                correctAnswer: 0
            };

            quizData.questions[7] = {
                id: 8,
                section: "Reading",
                question: "",
                description: "8. 다음 단어의 비슷한 말은 무엇입니까 ?",
                textBox2: "마찬 가지",
                options: ["당일", "동시", "동일", "당시"],
                correctAnswer: 0
            };

            quizData.questions[8] = {
                id: 9,
                section: "Reading",
                question: "[9 – 12] 빈칸에 들아갈 가장 알맞은 것을 고르십시오.",
                description: "9.",
                textBox: "저는 집에서 혼자 공부합니다. 집은 도서관보다 조용하고 편하게 책을 볼 수 있습니다. ____________공부할 수 있는 시간도 더 많습니다.",
                options: ["그래서", "그래야", "그리고", "그런데"],
                correctAnswer: 2
            };

            quizData.questions[9] = {
                id: 10,
                section: "Reading",
                question: "",
                description: "10.",
                textBox: "요즘 일이 많아서 너무 바쁩니다. 쉴 시간이___________없어서 너무 피곤합니다.",
                options: ["별로", "따로", "바로", "결코"],
                correctAnswer: 0
            };

            quizData.questions[10] = {
                id: 11,
                section: "Reading",
                question: "",
                description: "11.",
                textBox: "다음 달에 아파트 계약이 끝납니다. 그래서 부동산에 가서 집을_________.",
                options: ["소개해야 합니다", "청소해야 합니다", "정리해야 합니다", "알아봐야 합니다"],
                correctAnswer: 3
            };

            quizData.questions[11] = {
                id: 12,
                section: "Reading",
                question: "",
                description: "12.",
                textBox: "상수도관에 누수가 발생했다고 합니다. 상수도관에________이 생겨서 물이 새는 것 같습니다.",
                options: ["균열", "수풀", "토지", "연기"],
                correctAnswer: 0
            };

            quizData.questions[12] = {
                id: 13,
                section: "Reading",
                question: "[13 – 14] 다음 글을 읽고 무엇에 대한 글인지 고르십시오.",
                description: "13.",
                textBox: "한국의 무역은 부족한 천연자원은 수입하고, 이를 혁신적인 기술로 가공하여 고부가가치 제품을 만들어 수출하는 특성을 보입니다. 주요 수입 품목은 원유, 천연가스, 철강 원자재, 산업기계 및 장비, 농산물 및 식료품 등이고, 주요 수출 품목은 반도체, 스마트폰, 자동차, 조선, 석유화학 제품, 배터리 등입니다.",
                options: ["한국의 정치", "한국의 무역", "한국의 경제 발전", "한국의 일상 생활"],
                correctAnswer: 1
            };

            quizData.questions[13] = {
                id: 14,
                section: "Reading",
                question: "",
                description: "14.",
                textBox: "EPS-TOPIK 시험을 준비하고 싶어서 학원에 전화를 했습니다. 언제 수업을 하는지, 어떻게 신청을 하는지 등을 자세히 물어봤습니다.",
                options: ["신청 조건", "시설 안내", "수업 문의", "교육 기관"],
                correctAnswer: 2
            };

            quizData.questions[14] = {
                id: 15,
                section: "Reading",
                question: "[15 – 16] 다음 글을 읽고 내용과 같은 것을 고르십시오.",
                description: "15.",
                textBox: "부산은 한국에서 두 번째로 큰 도시로, 세계적인 규모의 부산항이 있으며, 아름다운 해변이 있어 많은 관광객들이 방문합니다. 인근에는 자동차, 조선, 중화학 산업이 발달한 공업 도시 울산이 있습니다. 이 외에도 한국의 남동쪽인 경상도 지방에는 섬유 산업의 도시인 대구가 있고 납서쪽의 전라도 지방에는 문화와 예술의 도시인 광주가 있습니다.",
                options: ["부산은 한국의 도시 중에서 첫 반째로 큰 곳입니다.", "대구가 한국의 남동쪽인 경상도 지방에은 전자산업의 도시입니다.", "부산은 한국의 도시 중에서 두 번째로 큰 곳 입니다.", "한국에서 가장 큰 동시인 부산 입니다."],
                correctAnswer: 2
            };

            quizData.questions[15] = {
                id: 16,
                section: "Reading",
                question: "",
                description: "16.",
                textBox: "갈모는 비가 올 때 갓 위에 덮어 쓰는 기름 먹인 종이로 만들어진 고깔 형태의 모자입니다. 갈모는 펼치면 위쪽이 뾰족하고 아래쪽은 동그랗게 퍼지며, 접으면 부채처럼 얇아집니다. 방수 기능이 있어 비 오는 날 갓을 보호하고, 착용자를 잘 지켜줍니다. 갈모는 전통적인 의상과 함께 사용되며, 주로 특별한 행사나 축제에서 많이 볼 수 있습니다. 또한, 농사일을 할 때도 사용되었으며, 농부들이 햇볕과 비를 피하기 위해 갈모테하고 갈모를 착용하기도 했습니다. 이렇게 갈모는 한국의 역사와 문화에서 중요한 역할을 하며, 전통 복장을 더욱 아름답게 만들어 줍니다.",
                options: ["갈모는 아래쪽이 뾰족하고 위쪽은 동그래요.", "보통 현대적인 의복과 함께 사용돼요.", "갈모 덕분에 전통 복장을 더 아름다워 보여요.", "갈모는 농사 일을 할때만 사용돼요."],
                correctAnswer: 2
            };

            quizData.questions[16] = {
                id: 17,
                section: "Reading",
                question: "17 – 18] 다음 설명에 알맞은 어휘를 고르십시오.",
                description: "17.",
                textBox: "콩으로 메주를 쒀 소금물에 담근 뒤에 그 즙액을 달여서 만든 장을 말합니다.",
                options: ["식초", "된장", "간장", "두부"],
                correctAnswer: 1
            };

            quizData.questions[17] = {
                id: 18,
                section: "Reading",
                question: "",
                description: "18.",
                textBox: "일전한 지역에 사는 사람의 수입니다.",
                options: ["도시", "인구", "구역", "중부"],
                correctAnswer: 1
            };

            quizData.questions[18] = {
                id: 19,
                section: "Reading",
                question: "[19– 20] 빈칸에 들어갈 가장 알맞은 것을 고르십시오.",
                description: "19.",
                textBox: "한국 정부는 스마트팜을 미래 농업의 핵심 분야로 인식하고, 다양한 정책으로 스마트팜의 보급과 발전을______________.",
                options: ["지원할 줄 압니다", "지원하고 있습니다", "제공할 줄 압니다", "제공하고 있습니다"],
                correctAnswer: 1
            };

            quizData.questions[19] = {
                id: 20,
                section: "Reading",
                question: "",
                description: "20.",
                textBox: "포장할 때 완충재로 제품을 꼼꼼하게__________중요해요. 그렇게 하지 않으면 운송할 때 제품이 손상될 수 있어요.",
                options: ["따는 게", "따는 걸", "싸는 게", "싸는 걸"],
                correctAnswer: 2
            };

            quizData.questions[20] = {
                id: 21,
                section: "Listening",
                question: "[21 – 24] 들은 것을 고르십시오.",
                description: "21.",
                textBox2: "____자",
                audio: "audio/21_p14.mp3",
                options: ["비", "피", "부", "바"],
                correctAnswer: 1
            };

            quizData.questions[21] = {
                id: 22,
                section: "Listening",
                question: "",
                description: "22.",
                textBox2: "창문을 __________.",
                audio: "audio/22_p14.mp3",
                options: ["닦으세요.", "닫으세요.", "받으세요.", "들으세요."],
                correctAnswer: 1
            };

            quizData.questions[22] = {
                id: 23,
                section: "Listening",
                question: "",
                description: "23.",
                audio: "audio/23_p14.mp3",
                options: [
                    { type: 'image', value: 'image/23_1_p14.png' },
                    { type: 'image', value: 'image/23_2_p14.png' },
                    { type: 'image', value: 'image/23_3_p14.png' },
                    { type: 'image', value: 'image/23_4_p14.png' }
                ],
                correctAnswer: 2
            };

            quizData.questions[23] = {
                id: 24,
                section: "Listening",
                question: "",
                description: "24.",
                audio: "audio/24_p14.mp3",
                options: [
                    { type: 'image', value: 'image/24_1_p14.png' },
                    { type: 'image', value: 'image/24_2_p14.png' },
                    { type: 'image', value: 'image/24_3_p14.png' },
                    { type: 'image', value: 'image/24_4_p14.png' }
                ],
                correctAnswer: 1
            };

            quizData.questions[24] = {
                id: 25,
                section: "Listening",
                question: "[25 – 29] 그림을 보고 알맞은 대답을 고르십시오.",
                description: "25. 이것은 무엇입니까 ?",
                image: "image/25_p14.png",
                options: [
                    { type: 'audio', value: 'audio/25_1_p14.mp3' },
                    { type: 'audio', value: 'audio/25_2_p14.mp3' },
                    { type: 'audio', value: 'audio/25_3_p14.mp3' },
                    { type: 'audio', value: 'audio/25_4_p14.mp3' }
                ],
                correctAnswer: 1
            };

            quizData.questions[25] = {
                id: 26,
                section: "Listening",
                question: "",
                description: "26. 여기는 어디입니까 ?",
                image: "image/26_p14.png",
                options: [
                    { type: 'audio', value: 'audio/26_1_p14.mp3' },
                    { type: 'audio', value: 'audio/26_2_p14.mp3' },
                    { type: 'audio', value: 'audio/26_3_p14.mp3' },
                    { type: 'audio', value: 'audio/26_4_p14.mp3' }
                ],
                correctAnswer: 2
            };

            quizData.questions[26] = {
                id: 27,
                section: "Listening",
                question: "",
                description: "27. 이 사람은 지금 무엇을 하고 있습니까 ?",
                image: "image/27_p14.png",
                options: [
                    { type: 'audio', value: 'audio/27_1_p14.mp3' },
                    { type: 'audio', value: 'audio/27_2_p14.mp3' },
                    { type: 'audio', value: 'audio/27_3_p14.mp3' },
                    { type: 'audio', value: 'audio/27_4_p14.mp3' }
                ],
                correctAnswer: 1
            };

            quizData.questions[27] = {
                id: 28,
                section: "Listening",
                question: "",
                description: "28. 나무가 얼마나 있습니까?",
                image: "image/28_p14.png",
                options: [
                    { type: 'audio', value: 'audio/28_1_p14.mp3' },
                    { type: 'audio', value: 'audio/28_2_p14.mp3' },
                    { type: 'audio', value: 'audio/28_3_p14.mp3' },
                    { type: 'audio', value: 'audio/28_4_p14.mp3' }
                ],
                correctAnswer: 2
            };

            quizData.questions[28] = {
                id: 29,
                section: "Listening",
                question: "",
                description: "29. 은행은 어디에 있습니까?",
                image: "image/29_p14.png",
                options: [
                    { type: 'audio', value: 'audio/29_1_p14.mp3' },
                    { type: 'audio', value: 'audio/29_2_p14.mp3' },
                    { type: 'audio', value: 'audio/29_3_p14.mp3' },
                    { type: 'audio', value: 'audio/29_4_p14.mp3' }
                ],
                correctAnswer: 2
            };

            quizData.questions[29] = {
                id: 30,
                section: "Listening",
                question: "[30 – 33] 다음을 듣고 질문에 알맞은 대답을 고르십시오.",
                description: "30.",
                audio: "audio/30_p14.mp3",
                options: ["오른쪽으로 가세요.", "의자 위에 있어요.", "사무실 안에 있어요.", "네, 근처에 있어요."],
                correctAnswer: 0
            };

            quizData.questions[30] = {
                id: 31,
                section: "Listening",
                question: "",
                description: "31.",
                audio: "audio/31_p14.mp3",
                options: ["네, 가벼워서 편하고 좋네요.", "네, 작업복이 오래돼서 새로 사야 겠네요.", "아니요. 아직 익숙하지 않아서 좀 힘들어요.", "아니요, 너무 비싸서 다른 걸로 바꾸고 싶어요."],
                correctAnswer: 0
            };

            quizData.questions[31] = {
                id: 32,
                section: "Listening",
                question: "",
                description: "32.",
                audio: "audio/32_p14.mp3",
                options: ["우리 반장님이 일을 항상 시켜요.", "반장님이 잘 가르쳐 주신 덕분이에요.", "일을 잘 하니까 승진을 했어요.", "일이 끝난 대로 바로 정리합시다."],
                correctAnswer: 1
            };

            quizData.questions[32] = {
                id: 33,
                section: "Listening",
                question: "",
                description: "33.",
                audio: "audio/33_p14.mp3",
                options: ["직원을 하난 뽑았어요.", "직원들끼리 항상 배려야 해요.", "부지런하고 성실하게 일해요.", "직원들이 주말에 일을 안 해요."],
                correctAnswer: 2
            };

            quizData.questions[33] = {
                id: 34,
                section: "Listening",
                question: "[34 – 35] 다음을 듣고 이어지는 말을 고르십시오.",
                description: "34.",
                audio: "audio/34_p14.mp3",
                options: ["운동을 시작하지 그래?", "조금 힘들지만 할 만해.", "건강하니까 힘들지 않아.", "어찌나 운동이 힘든지 포기했어."],
                correctAnswer: 1
            };

            quizData.questions[34] = {
                id: 35,
                section: "Listening",
                question: "",
                description: "35.",
                audio: "audio/35_p14.mp3",
                options: ["배가 안 고파서 좋네요.", "이 우유 좀 마셔 볼래요?", "아침마다 빵을 하나 먹었어요.", "저도 항상 아침 식사를 했어요."],
                correctAnswer: 1
            };

            quizData.questions[35] = {
                id: 36,
                section: "Listening",
                question: "[36 – 37] 잘 듣고 들은 내용과 관계있는 그림을 고르십시오.",
                description: "36.",
                audio: "audio/36_p14.mp3",
                options: [
                    { type: 'image', value: 'image/36_1_p14.png' },
                    { type: 'image', value: 'image/36_2_p14.png' },
                    { type: 'image', value: 'image/36_3_p14.png' },
                    { type: 'image', value: 'image/36_4_p14.png' }
                ],
                correctAnswer: 2
            };

            quizData.questions[36] = {
                id: 37,
                section: "Listening",
                question: "",
                description: "37.",
                audio: "audio/37_p14.mp3",
                options: [
                    { type: 'image', value: 'image/37_1_p14.png' },
                    { type: 'image', value: 'image/37_2_p14.png' },
                    { type: 'image', value: 'image/37_3_p14.png' },
                    { type: 'image', value: 'image/37_4_p14.png' }
                ],
                correctAnswer: 0
            };

            quizData.questions[37] = {
                id: 38,
                section: "Listening",
                question: "[38 – 40] 이야기를 듣고 질문에 알맞은 대답을 고르십시오.",
                description: "38. 두 사람이 무엇에 대해 이야기하고 있는지 고르십시오.",
                audio: "audio/38_p14.mp3",
                options: ["주말에 해야 하는 일", "친구와 여행 갈 장소", "여자 친구가 없는 이유", "친구를 사귈 수 있는 방법"],
                correctAnswer: 3
            };

            quizData.questions[38] = {
                id: 39,
                section: "Listening",
                question: "",
                description: "39. 대화를 듣고 내용과 같은 것을 고르십시오.",
                audio: "audio/39_p14.mp3",
                options: ["도장이 없으면 통장을 만들 수 없습니다.", "여자는 체크 카드를 재발급을 하려고 합니다.", "거주지 증명 서류가 여기에서 필요가 없습니다.", "M-Bangking 을 이용하려면 앱을 다운로드 해야 돼요."],
                correctAnswer: 3
            };

            quizData.questions[39] = {
                id: 40,
                section: "Listening",
                question: "",
                description: "40. 대화를 듣고 내용과 같은 것을 고르십시오.",
                audio: "audio/40_p14.mp3",
                options: ["차가운 물을 사용하는 게 좋습니다.", "설탕물에 빨면 색이 변하지 않습니다.", "세탁한 후에 치약을 이용해야 합니다.", "운동화를 치약으로 빨면 더 하얗게 됩니다."],
                correctAnswer: 3
            };

            initializeQuiz();
        }

        function initializeQuiz() {
            generateQuestions();
            generateAnswers();
            updateCorrectAnswers();
            showQuestion(1);
            updateQuestionCounters();
            startTimer();
            updateTimerDisplay();
        }

        function generateQuestions() {
            const soalDiv = document.querySelector('.soal');
            soalDiv.innerHTML = '';

            quizData.questions.forEach(q => {
                const questionHTML = `
                <div class="pertanyaan" data-id="${q.id}" style="position: relative;">
                    <h3>${q.question}</h3>
                    ${q.description ? `<div class="deskripsi-soal">${q.description}</div>` : ''}

                    ${q.additionalText ? `
                        <div class="teks-tambahan ${q.textPosition || 'tengah'}" 
                            style="${q.textStyle || ''}">
                            ${q.additionalText}
                        </div>
                    ` : ''}

                    ${q.textBox2 ? `
                        <div class="text-box-2">
                            ${q.textBox2}
                        </div>
                    ` : ''}

                    ${q.audio ? `
                    <div id="audio-control-${q.id}" class="audio-control" style="display: block;">
                        <div class="custom-audio-player">
                            <img src="play-icon.png" 
                                alt="Play" 
                                id="play-icon-${q.id}" 
                                class="audio-icon"
                                onclick="playAudio(${q.id}, '${q.audio}')">
                        </div>
                    </div>
                    ` : ''}

                    ${q.textBox ? `
                        <div class="text-box">
                            ${q.textBox}
                        </div>
                    ` : ''}

                    ${q.image ? `
                        <div class="gambar-container">
                            <img src="${q.image}" alt="Gambar soal ${q.id}" onclick="bukaZoom(this.src)">
                        </div>
                    ` : ''}
                </div>
                `;
                soalDiv.insertAdjacentHTML('beforeend', questionHTML);
            });
        }

        function underlineLastWord(sentence) {
            const match = sentence.match(/(.+ )(.+?)$/);
            if (!match) return sentence;
            return `${match[1]}<u>${match[2]}</u>`;
        }

        function generateAnswers() {
            const jawabanDiv = document.querySelector('.jawaban');
            jawabanDiv.innerHTML = '';

            quizData.questions.forEach(q => {
                const answerHTML = `
            <div class="jawaban-container" data-question="${q.id}" ${q.id !== 1 ? 'style="display:none;"' : ''}>
                ${q.options.map((option, index) => {
                    let content = '';

                    if (typeof option === 'object' && option !== null) {
                        if (option.type === 'image') {
                            content = `
                                <div onclick="event.stopPropagation(); bukaZoom('${option.value}')" style="cursor: pointer;">
                                    <img src="${option.value}" class="jawaban-gambar" alt="Option ${index + 1}">
                                </div>
                            `;
                        } else if (option.type === 'audio') {
                            content = `
                                <div class="jawaban-audio-player" id="jawaban-audio-${q.id}-${index}">
                                    <button onclick="playJawabanAudio(${q.id}, ${index}, '${option.value}')">
                                        <img src="play-icon.png" alt="Play" id="jawaban-play-icon-${q.id}-${index}">
                                    </button>
                                </div>
                            `;
                        } else {
                            content = option.value || '';
                        }
                    } else {
                        content = option || '';
                    }

                    return `
                        <div class="jawaban-item">
                            <div class="lingkaran" onclick="pilihJawaban(this)">${index + 1}</div>
                            <div class="jawaban-content">
                                ${content}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
                jawabanDiv.insertAdjacentHTML('beforeend', answerHTML);
            });
        }

        function updateCorrectAnswers() {
            quizData.questions.forEach(q => {
                correctAnswers[q.id] = (q.correctAnswer + 1).toString();
            });
        }

        function pilihJawaban(el) {
            const item = el.closest(".jawaban-item");
            const container = item.closest(".jawaban-container");
            const questionNumber = parseInt(container.getAttribute("data-question"));

            const isNewAnswer = !userAnswers.hasOwnProperty(questionNumber);

            container.querySelectorAll(".jawaban-item").forEach(el => {
                el.classList.remove("selected");
            });
            item.classList.add("selected");

            userAnswers[questionNumber] = el.textContent.trim();

            if (isNewAnswer) {
                remainingQuestions--;
                updateQuestionCounters();
            }

            updateNavButtons();
        }

        function bukaZoom(src) {
            const overlay = document.getElementById("zoomOverlay");
            const gambar = document.getElementById("gambarZoom");

            overlay.style.zIndex = '100000';
            overlay.style.display = "flex";
            document.body.style.overflow = "hidden";
            gambar.src = src;
            gambar.style.transform = 'none';
            gambar.style.maxWidth = 'none';
            gambar.style.maxHeight = 'none';

            if (panzoomInstance) panzoomInstance.destroy();

            gambar.onload = function () {
                const imgRatio = this.naturalWidth / this.naturalHeight;
                const screenRatio = window.innerWidth / window.innerHeight;

                if (imgRatio > screenRatio) {
                    this.style.width = '90vw';
                    this.style.height = 'auto';
                } else {
                    this.style.width = 'auto';
                    this.style.height = '90vh';
                }

                panzoomInstance = Panzoom(this, {
                    maxScale: 5,
                    minScale: 0.8,
                    contain: 'outside',
                    startScale: 1,
                    step: 0.2,
                    animate: true,
                    duration: 200,
                    easing: 'ease-in-out',
                    panOnlyWhenZoomed: true,
                    disablePan: false,
                    disableZoom: false,
                    disableXAxis: false,
                    disableYAxis: false,
                    cursor: 'move'
                });

                const zoomArea = document.querySelector('.zoom-area');
                zoomArea.addEventListener('wheel', function (e) {
                    e.preventDefault();
                    panzoomInstance.zoomWithWheel(e);
                }, { passive: false });

                zoomArea.addEventListener('touchmove', function (e) {
                    if (e.touches.length === 2) e.preventDefault();
                }, { passive: false });
            };
        }

        function tutupZoom() {
            const overlay = document.getElementById("zoomOverlay");
            overlay.style.display = "none";
            document.body.style.overflow = "auto";
            if (panzoomInstance) {
                panzoomInstance.destroy();
                panzoomInstance = null;
            }
        }

        function showQuestion(questionNumber) {
            if (questionNumber < 1) questionNumber = 1;
            if (questionNumber > totalQuestions) questionNumber = totalQuestions;

            const readingHeader = document.querySelector('.header-bar div:nth-child(1)');
            readingHeader.textContent = questionNumber <= 20 ? 'Reading (20 Questions)' : 'Listening (20 Questions)';

            document.querySelectorAll('.pertanyaan').forEach(q => q.classList.remove('active'));
            const questionElement = document.querySelector(`.pertanyaan[data-id="${questionNumber}"]`);
            if (questionElement) questionElement.classList.add('active');

            document.querySelectorAll('.jawaban-container').forEach(a => a.style.display = 'none');
            const currentAnswerContainer = document.querySelector(`.jawaban-container[data-question="${questionNumber}"]`);
            if (currentAnswerContainer) {
                currentAnswerContainer.style.display = 'block';
                if (userAnswers[questionNumber]) {
                    const circles = currentAnswerContainer.querySelectorAll('.lingkaran');
                    circles.forEach(circle => {
                        if (circle.textContent.trim() === userAnswers[questionNumber]) {
                            circle.closest('.jawaban-item').classList.add('selected');
                        }
                    });
                }
            }

            const soalDiv = document.querySelector('.soal');
            const jawabanDiv = document.querySelector('.jawaban');

            if (soalDiv) soalDiv.scrollTop = 0;
            if (jawabanDiv) jawabanDiv.scrollTop = 0;

            stopAllAudio();
            currentQuestion = questionNumber;
            updateNavButtons();
            updateCurrentQuestionDisplay();
        }

        function nextQuestion() {
            if (currentQuestion < totalQuestions) showQuestion(currentQuestion + 1);
        }

        function prevQuestion() {
            if (currentQuestion > 1) showQuestion(currentQuestion - 1);
        }

        function updateNavButtons() {
            const prevBtn = document.querySelector('.footer-button button:first-child');
            const nextBtn = document.querySelector('.footer-button button:last-child');

            prevBtn.disabled = currentQuestion === 1;

            if (currentQuestion === totalQuestions) {
                nextBtn.textContent = "Finish";
                nextBtn.onclick = finishQuiz;
            } else {
                nextBtn.textContent = "Next Question";
                nextBtn.onclick = nextQuestion;
            }
        }

        function updateCurrentQuestionDisplay() {
            document.getElementById('current-question').textContent = currentQuestion;
        }

        function updateQuestionCounters() {
            document.querySelector('.header-bar div:nth-child(5)').textContent = remainingQuestions;
            document.querySelector('.header-bar div:nth-child(3)').textContent = '40';
        }

        function showQuestionList() {
            const questionListOverlay = document.createElement('div');
            questionListOverlay.id = 'questionListOverlay';
            questionListOverlay.style.position = 'fixed';
            questionListOverlay.style.top = '0';
            questionListOverlay.style.left = '0';
            questionListOverlay.style.width = '100vw';
            questionListOverlay.style.height = '100vh';
            questionListOverlay.style.backgroundColor = 'white';
            questionListOverlay.style.backgroundImage = 'url("logo.png")';
            questionListOverlay.style.backgroundSize = '14% auto';
            questionListOverlay.style.backgroundPosition = 'top center';
            questionListOverlay.style.backgroundRepeat = 'no-repeat';
            questionListOverlay.style.backgroundAttachment = 'fixed';
            questionListOverlay.style.display = 'flex';
            questionListOverlay.style.justifyContent = 'center';
            questionListOverlay.style.alignItems = 'center';
            questionListOverlay.style.zIndex = '10000';
            questionListOverlay.style.overflow = 'auto';
            questionListOverlay.style.boxSizing = 'border-box';
            questionListOverlay.style.padding = '10px';

            const questionListContainer = document.createElement('div');
            questionListContainer.style.backgroundColor = 'tranparent';
            questionListContainer.style.padding = '20px';
            questionListContainer.style.paddingLeft = '30px';
            questionListContainer.style.paddingBottom = '20px';
            questionListContainer.style.border = 'none';
            questionListContainer.style.width = '100%';
            questionListContainer.style.maxWidth = '1000px';
            questionListContainer.style.maxHeight = '90vh';
            questionListContainer.style.margin = '0 auto';
            questionListContainer.style.overflowY = 'auto';
            questionListContainer.style.display = 'flex';
            questionListContainer.style.flexDirection = 'column';
            questionListContainer.style.boxSizing = 'border-box';

            const sectionsContainer = document.createElement('div');
            sectionsContainer.style.display = 'flex';
            sectionsContainer.style.gap = '10px';
            sectionsContainer.style.justifyContent = 'space-between';
            sectionsContainer.style.flexWrap = 'nowrap';
            sectionsContainer.style.width = '100%';
            sectionsContainer.style.boxSizing = 'border-box';

            const readingSection = document.createElement('div');
            readingSection.style.flex = '1';
            readingSection.style.minWidth = '280px';
            readingSection.style.maxWidth = '350px';
            readingSection.style.order = '1';

            const readingTitle = document.createElement('h4');
            readingTitle.textContent = 'Reading (1-20)';
            readingTitle.style.textAlign = 'center';
            readingTitle.style.marginBottom = '15px';
            readingTitle.style.color = '#333';
            readingSection.appendChild(readingTitle);

            const readingGrid = document.createElement('div');
            readingGrid.style.display = 'grid';
            readingGrid.style.gridTemplateColumns = 'repeat(5, 55px)';
            readingGrid.style.gridTemplateRows = 'repeat(4, 50px)';
            readingGrid.style.gap = '12px';
            readingGrid.style.width = '100%';
            readingGrid.style.justifyContent = 'center';

            for (let i = 1; i <= 20; i++) {
                const questionBtn = createQuestionButton(i);
                questionBtn.style.width = '55px';
                questionBtn.style.height = '50px';
                questionBtn.style.borderRadius = '8px';
                questionBtn.style.display = 'flex';
                questionBtn.style.alignItems = 'center';
                questionBtn.style.justifyContent = 'center';
                questionBtn.style.boxSizing = 'border-box';
                readingGrid.appendChild(questionBtn);
            }

            readingSection.appendChild(readingGrid);
            sectionsContainer.appendChild(readingSection);

            const listeningSection = document.createElement('div');
            listeningSection.style.flex = '1';
            listeningSection.style.minWidth = '280px';
            listeningSection.style.maxWidth = '350px';
            listeningSection.style.order = '2';

            const listeningTitle = document.createElement('h4');
            listeningTitle.textContent = 'Listening (21-40)';
            listeningTitle.style.textAlign = 'center';
            listeningTitle.style.marginBottom = '15px';
            listeningTitle.style.color = '#333';
            listeningSection.appendChild(listeningTitle);

            const listeningGrid = document.createElement('div');
            listeningGrid.style.display = 'grid';
            listeningGrid.style.gridTemplateColumns = 'repeat(5, 55px)';
            listeningGrid.style.gridTemplateRows = 'repeat(4, 50px)';
            listeningGrid.style.gap = '12px';
            listeningGrid.style.width = '100%';
            listeningGrid.style.justifyContent = 'center';

            for (let i = 21; i <= 40; i++) {
                const questionBtn = createQuestionButton(i);
                questionBtn.style.width = '55px';
                questionBtn.style.height = '50px';
                questionBtn.style.borderRadius = '8px';
                questionBtn.style.display = 'flex';
                questionBtn.style.alignItems = 'center';
                questionBtn.style.justifyContent = 'center';
                questionBtn.style.boxSizing = 'border-box';
                listeningGrid.appendChild(questionBtn);
            }

            listeningSection.appendChild(listeningGrid);
            sectionsContainer.appendChild(listeningSection);

            questionListContainer.appendChild(sectionsContainer);
            questionListOverlay.appendChild(questionListContainer);
            document.body.appendChild(questionListOverlay);
        }

        function createQuestionButton(questionNumber) {
            const questionBtn = document.createElement('button');
            questionBtn.textContent = questionNumber;
            questionBtn.style.width = '60px';
            questionBtn.style.height = '40px';
            questionBtn.style.borderRadius = '15%';
            questionBtn.style.border = '1px solid #ccc';
            questionBtn.style.cursor = 'pointer';
            questionBtn.style.fontWeight = 'bold';
            questionBtn.style.transition = 'all 0.2s';

            if (questionNumber === currentQuestion) {
                questionBtn.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
                questionBtn.style.color = 'black';
                questionBtn.style.transform = 'none';
                questionBtn.style.boxShadow = 'none';
            }

            if (userAnswers[questionNumber]) {
                questionBtn.style.backgroundColor = userAnswers[questionNumber] === correctAnswers[questionNumber] ? 'black' : 'black';
                questionBtn.style.color = 'white';
            }

            questionBtn.onclick = function () {
                const overlay = document.getElementById('questionListOverlay');
                if (overlay) {
                    document.body.removeChild(overlay);
                }
                showQuestion(questionNumber);
            };

            questionBtn.onmouseover = function () {
                if (questionNumber !== currentQuestion) {
                    this.style.backgroundColor = 'none';
                }
            };

            questionBtn.onmouseout = function () {
                if (questionNumber !== currentQuestion) {
                    this.style.backgroundColor = 'none';
                }
            };

            return questionBtn;
        }

        function finishQuiz() {
            const dialog = document.createElement('div');
            dialog.className = 'custom-dialog';
            dialog.innerHTML = `
                <div class="custom-dialog-content">
                    <h3>Konfirmasi</h3>
                    <p>Apakah Anda yakin ingin menyelesaikan Ujian dan melihat hasil?</p>
                    <div class="custom-dialog-buttons">
                        <button class="custom-dialog-button custom-dialog-cancel">Batal</button>
                        <button class="custom-dialog-button custom-dialog-confirm">Ya, Selesaikan</button>
                    </div>
                </div>
            `;

            document.body.appendChild(dialog);

            dialog.querySelector('.custom-dialog-cancel').addEventListener('click', () => {
                document.body.removeChild(dialog);
            });

            dialog.querySelector('.custom-dialog-confirm').addEventListener('click', () => {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }

                document.body.removeChild(dialog);
                showQuizResults();
            });
        }

        function showQuizResults() {
            score = 0;
            for (let i = 1; i <= totalQuestions; i++) {
                if (userAnswers[i] && userAnswers[i] === correctAnswers[i]) {
                    score++;
                }
            }

            const resultOverlay = document.createElement('div');
            resultOverlay.className = 'result-overlay';

            const resultContent = document.createElement('div');
            resultContent.className = 'result-content';
            resultContent.innerHTML = `
                <h2 style="color: #2c7be5; margin-bottom: 20px; text-align: center;">Results</h2>
                <div style="display: flex; justify-content: space-around; margin-bottom: 30px;">
                    <div style="flex: 1; text-align: center;">
                        <h3 style="color: #4CAF50;">Reading</h3>
                        <p>${calculateSectionScore(1, 20)}/20</p>
                        <p>${Math.round(calculateSectionScore(1, 20) / 20 * 100)}%</p>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <h3 style="color: #f44336;">Listening</h3>
                        <p>${calculateSectionScore(21, 40)}/20</p>
                        <p>${Math.round(calculateSectionScore(21, 40) / 20 * 100)}%</p>
                    </div>
                </div>
                <h3 style="margin-bottom: 10px; text-align: center;">Total Score</h3>
                <p style="font-size: 24px; font-weight: bold; margin-bottom: 30px; text-align: center;">${score}/${totalQuestions}</p>
                <button id="reviewBtn" class="close-result-btn">Review All Answers</button>
            `;

            resultOverlay.appendChild(resultContent);
            document.body.appendChild(resultOverlay);

            document.getElementById('reviewBtn').addEventListener('click', () => {
                document.body.removeChild(resultOverlay);
                showAllQuestionsReview();
            });
        }

        function showAllQuestionsReview() {
            const reviewOverlay = document.createElement('div');
            reviewOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background-color: white;
                overflow-y: auto;
                z-index: 10000;
                padding: 20px 0;
                padding-left: 40px;
                padding-right: 40px;
            `;

            const container = document.createElement('div');
            container.style.cssText = `
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
                box-sizing: border-box;
            `;

            const header = document.createElement('div');
            header.style.cssText = `
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                padding-bottom: 15px;
                border-bottom: 1px solid #eee;
            `;

            const title = document.createElement('h2');
            title.textContent = 'Review All Answers';
            title.style.cssText = `
                color: #2c7be5;
                font-size: 28px;
                margin: 0;
            `;
            header.appendChild(title);
            container.appendChild(header);

            for (let i = 1; i <= totalQuestions; i++) {
                if (i === 1 || i === 21) {
                    const sectionLabel = document.createElement('h3');
                    sectionLabel.textContent = i === 1 ? 'Reading Section (1-20)' : 'Listening Section (21-40)';
                    sectionLabel.style.cssText = `
                        color: ${i === 1 ? '#4CAF50' : '#f44336'};
                        margin: 30px 0 20px;
                        padding-bottom: 10px;
                        border-bottom: 2px solid ${i === 1 ? '#4CAF50' : '#f44336'};
                    `;
                    container.appendChild(sectionLabel);
                }

                const questionData = quizData.questions.find(q => q.id === i) || {};
                const questionDiv = document.createElement('div');
                questionDiv.style.cssText = `
                    background: white;
                    border: 1px solid #e0e0e0;
                    border-radius: 8px;
                    padding: 30px;
                    margin-bottom: 30px;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                    box-sizing: border-box;
                `;

                const questionHeader = document.createElement('div');
                questionHeader.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 20px;
                `;

                const questionNumber = document.createElement('h3');
                questionNumber.textContent = `Question ${i}`;
                questionNumber.style.cssText = `
                    color: #333;
                    margin: 0;
                `;

                const answerStatus = document.createElement('span');
                if (userAnswers[i]) {
                    const isCorrect = userAnswers[i] == (questionData.correctAnswer + 1);
                    answerStatus.textContent = isCorrect ? '✓ Correct' : '✗ Incorrect';
                    answerStatus.style.cssText = `
                        color: ${isCorrect ? '#4CAF50' : '#f44336'};
                        font-weight: bold;
                    `;
                } else {
                    answerStatus.textContent = 'Not answered';
                    answerStatus.style.cssText = `
                        color: #9E9E9E;
                        font-weight: bold;
                    `;
                }

                questionHeader.appendChild(questionNumber);
                questionHeader.appendChild(answerStatus);
                questionDiv.appendChild(questionHeader);

                const questionContent = document.createElement('div');
                questionContent.className = 'review-question-content';

                if (questionData.question) {
                    const questionText = document.createElement('p');
                    questionText.style.cssText = `
                        font-weight: bold;
                        margin-bottom: 15px;
                        line-height: 1.5;
                    `;
                    questionText.textContent = questionData.question;
                    questionContent.appendChild(questionText);
                }

                if (questionData.description) {
                    const descText = document.createElement('p');
                    descText.style.cssText = `
                        margin-bottom: 15px;
                        line-height: 1.5;
                    `;
                    descText.textContent = questionData.description;
                    questionContent.appendChild(descText);
                }

                if (questionData.textBox) {
                    const textBoxDiv = document.createElement('div');
                    textBoxDiv.className = 'text-box';
                    textBoxDiv.style.cssText = `
                        max-width: 90%;
                        margin: 15px auto;
                        padding: 15px;
                        background-color: white;
                        border: 1px solid #cacaca;
                        line-height: 1.5;
                    `;
                    textBoxDiv.innerHTML = questionData.textBox;
                    questionContent.appendChild(textBoxDiv);
                }

                if (questionData.textBox2) {
                    const textBox2Div = document.createElement('div');
                    textBox2Div.className = 'text-box-2';
                    textBox2Div.style.cssText = `
                        max-width: 90%;
                        margin: 15px auto;
                        padding: 15px;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        text-align: center;
                        background-color: white;
                        border: 1px solid #cacaca;
                        line-height: 1.5;
                    `;
                    textBox2Div.innerHTML = questionData.textBox2;
                    questionContent.appendChild(textBox2Div);
                }

                if (questionData.image) {
                    const questionImage = document.createElement('img');
                    questionImage.src = questionData.image;
                    questionImage.style.cssText = `
                        display: block;
                        max-width: 80%;
                        height: auto;
                        margin: 20px auto;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: transform 0.2s;
                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                    `;
                    questionImage.onclick = (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        bukaZoom(questionData.image);
                    };
                    questionContent.appendChild(questionImage);
                }

                if (questionData.audio) {
                    questionContent.appendChild(createAudioPlayer(questionData.audio, i.toString(), 'Play Question Audio'));
                }

                questionDiv.appendChild(questionContent);

                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'review-options';
                optionsContainer.style.cssText = `
                    margin-top: 20px;
                `;

                const options = questionData.options || ["Option 1", "Option 2", "Option 3", "Option 4"];
                const correctAnswerIndex = questionData.correctAnswer || 0;
                const userAnswerIndex = userAnswers[i] ? parseInt(userAnswers[i]) - 1 : -1;

                for (let j = 0; j < options.length; j++) {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'review-option';
                    optionDiv.style.cssText = `
                        display: flex;
                        align-items: center;
                        padding: 12px 15px;
                        margin-bottom: 8px;
                        border-radius: 6px;
                        border: 1px solid #ddd;
                        transition: all 0.2s;
                    `;

                    if (j === correctAnswerIndex) {
                        optionDiv.style.cssText += `
                            border: 1px solid rgba(0, 0, 0, 0.1);
                        `;
                        optionDiv.classList.add('correct');
                    }
                    if (j === userAnswerIndex) {
                        optionDiv.style.cssText += `
                            background-color: #FFEBEE;
                        `;
                        optionDiv.classList.add('user-selected');
                    }
                    if (j === correctAnswerIndex && j === userAnswerIndex) {
                        optionDiv.style.cssText += `
                            background-color: #E8F5E9;
                        `;
                    }

                    const optionNumber = document.createElement('div');
                    optionNumber.className = 'review-option-number';
                    optionNumber.style.cssText = `
                        width: 28px;
                        height: 28px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-right: 12px;
                        font-weight: bold;
                        background-color: #f5f5f5;
                    `;

                    if (optionDiv.classList.contains('correct')) {
                        optionNumber.style.cssText += `
                            background-color: #4CAF50;
                            color: white;
                        `;
                    }
                    if (optionDiv.classList.contains('user-selected') && !optionDiv.classList.contains('correct')) {
                        optionNumber.style.cssText += `
                            background-color: #f44336;
                            color: white;
                        `;
                    }

                    optionNumber.textContent = j + 1;
                    optionDiv.appendChild(optionNumber);

                    const optionContent = document.createElement('div');
                    optionContent.style.cssText = `
                        flex-grow: 1;
                    `;

                    if (typeof options[j] === 'object' && options[j] !== null && options[j].type) {
                        switch (options[j].type) {
                            case 'image':
                                const optionImage = document.createElement('img');
                                optionImage.src = options[j].value;
                                optionImage.style.cssText = `
                                    max-width: 200px;
                                    max-height: 120px;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                    transition: transform 0.2s;
                                `;
                                optionImage.onmouseover = () => optionImage.style.transform = 'scale(1.02)';
                                optionImage.onmouseout = () => optionImage.style.transform = 'none';
                                optionImage.onclick = (e) => {
                                    e.stopPropagation();
                                    e.preventDefault();
                                    bukaZoom(options[j].value);
                                };
                                optionContent.appendChild(optionImage);
                                break;

                            case 'audio':
                                const audioContainer = createAudioPlayer(options[j].value, `${i}-${j}`, `Play Option ${j + 1} Audio`);
                                optionContent.appendChild(audioContainer);
                                break;

                            default:
                                optionContent.innerHTML = options[j].value || '';
                        }
                    } else {
                        optionContent.innerHTML = options[j] || '';
                    }

                    optionDiv.appendChild(optionContent);
                    optionsContainer.appendChild(optionDiv);
                }

                questionDiv.appendChild(optionsContainer);
                container.appendChild(questionDiv);
            }

            const closeBtnContainer = document.createElement('div');
            closeBtnContainer.style.cssText = `
                display: flex;
                justify-content: center;
                margin-top: 40px;
                margin-bottom: 30px;
            `;

            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'Close';
            closeBtn.style.cssText = `
                padding: 12px 24px;
                background-color: #6eb0f1;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
                transition: background-color 0.2s;
            `;
            closeBtn.onmouseover = () => closeBtn.style.backgroundColor = '#5a9bd5';
            closeBtn.onmouseout = () => closeBtn.style.backgroundColor = '#6eb0f1';
            closeBtn.addEventListener('click', () => {
                window.location.replace('index.html');
            });

            closeBtnContainer.appendChild(closeBtn);
            container.appendChild(closeBtnContainer);
            reviewOverlay.appendChild(container);
            document.body.appendChild(reviewOverlay);
        }

        function createAudioPlayer(audioSrc, id, labelText) {
            const audioContainer = document.createElement('div');
            audioContainer.style.width = '100%';
            audioContainer.style.marginTop = '10px';

            const audioPlayer = document.createElement('div');
            audioPlayer.style.display = 'flex';
            audioPlayer.style.alignItems = 'center';
            audioPlayer.style.gap = '10px';

            const audioBtn = document.createElement('button');
            audioBtn.className = 'review-audio-btn';
            audioBtn.onclick = () => playReviewAudio(audioSrc, audioBtn);

            const audioIcon = document.createElement('img');
            audioIcon.src = 'play-icon.png';
            audioIcon.alt = 'Play';
            audioIcon.style.width = '60px';
            audioIcon.style.height = '60px';
            audioBtn.appendChild(audioIcon);

            const audioLabel = document.createElement('span');
            audioLabel.textContent = labelText;
            audioLabel.style.fontSize = '14px';

            audioPlayer.appendChild(audioBtn);
            audioPlayer.appendChild(audioLabel);
            audioContainer.appendChild(audioPlayer);

            const transcriptId = id.includes('-') ? id : `${id}`;

            console.log(`Mencari transcript untuk ID: ${transcriptId}`);
            console.log('Data transcript tersedia:', audioTranscripts);

            if (audioTranscripts && audioTranscripts[transcriptId]) {
                const transcript = document.createElement('div');
                transcript.className = 'audio-transcript';
                transcript.innerHTML = audioTranscripts[transcriptId];
                audioContainer.appendChild(transcript);
            } else {
                console.warn(`Transcript tidak ditemukan untuk ID: ${transcriptId}`);
            }

            return audioContainer;
        }

        function playAudio(questionId, audioSrc) {
            const playIcon = document.getElementById(`play-icon-${questionId}`);

            if (audioPlayCounts[questionId] >= 2) {
                playIcon.style.pointerEvents = 'none';
                playIcon.style.opacity = '0.5';
                return;
            }

            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            audioPlayCounts[questionId] = (audioPlayCounts[questionId] || 0) + 1;
            currentAudio = new Audio(audioSrc);

            currentAudio.onplay = () => {
                playIcon.src = "pause-icon.png";
                playIcon.alt = "Pause";
                playIcon.classList.add("playing");
            };

            currentAudio.onpause = () => {
                playIcon.src = "play-icon.png";
                playIcon.alt = "Play";
                playIcon.classList.remove("playing");
            };

            currentAudio.onended = () => {
                playIcon.src = "play-icon.png";
                playIcon.alt = "Play";
                playIcon.classList.remove("playing");

                if (audioPlayCounts[questionId] >= 2) {
                    playIcon.style.pointerEvents = 'none';
                    playIcon.style.opacity = '0.5';
                }
            };


            currentAudio.play();
        }

        function playJawabanAudio(questionId, optionIndex, audioSrc) {
            if (jawabanAudioPlayCounts[`${questionId}-${optionIndex}`] >= 2) return;
            stopAllAudio();

            jawabanAudioPlayCounts[`${questionId}-${optionIndex}`] = (jawabanAudioPlayCounts[`${questionId}-${optionIndex}`] || 0) + 1;
            currentAudio = new Audio(audioSrc);
            const playIcon = document.getElementById(`jawaban-play-icon-${questionId}-${optionIndex}`);
            const audioBtn = playIcon.parentElement;

            currentAudio.onplay = () => {
                playIcon.src = "pause-icon.png";
                playIcon.alt = "Pause";
            };

            currentAudio.onpause = () => {
                playIcon.src = "play-icon.png";
                playIcon.alt = "Play";
            };

            currentAudio.onended = () => {
                playIcon.src = "play-icon.png";
                playIcon.alt = "Play";
                if (jawabanAudioPlayCounts[`${questionId}-${optionIndex}`] >= 2) audioBtn.disabled = true;
            };

            currentAudio.play();
        }

        function stopAllAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            document.querySelectorAll('[id^="jawaban-play-icon-"]').forEach(icon => {
                icon.src = "play-icon.png";
                icon.alt = "Play";
            });
        }

        function playReviewAudio(audioSrc, button) {
            const audioIcon = button.querySelector('img');

            if (currentReviewAudio && currentReviewAudio.src.endsWith(audioSrc)) {
                if (!currentReviewAudio.paused) {
                    currentReviewAudio.pause();
                    audioIcon.src = 'play-icon.png';
                    audioIcon.alt = 'Play';
                    return;
                } else {
                    currentReviewAudio.play();
                    audioIcon.src = 'pause-icon.png';
                    audioIcon.alt = 'Pause';
                    return;
                }
            }

            stopAllReviewAudio();
            currentReviewAudio = new Audio(audioSrc);
            currentReviewAudioButton = button;

            let playerContainer = button.nextElementSibling;
            if (!playerContainer || !playerContainer.classList.contains('audio-player-container')) {
                playerContainer = document.createElement('div');
                playerContainer.className = 'audio-player-container';
                button.parentNode.insertBefore(playerContainer, button.nextSibling);
            } else {
                playerContainer.innerHTML = '';
            }

            const progressContainer = document.createElement('div');
            progressContainer.className = 'progress-container';
            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar';
            progressContainer.appendChild(progressBar);

            const timeContainer = document.createElement('div');
            timeContainer.className = 'time-container';

            currentTimeDisplay = document.createElement('span');
            currentTimeDisplay.className = 'current-time';
            currentTimeDisplay.textContent = '0:00';

            durationDisplay = document.createElement('span');
            durationDisplay.className = 'duration';
            durationDisplay.textContent = '0:00';

            timeContainer.appendChild(currentTimeDisplay);
            timeContainer.appendChild(document.createTextNode(' / '));
            timeContainer.appendChild(durationDisplay);

            playerContainer.appendChild(progressContainer);
            playerContainer.appendChild(timeContainer);
            currentProgressContainer = progressContainer;

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            };

            currentReviewAudio.addEventListener('loadedmetadata', () => {
                durationDisplay.textContent = formatTime(currentReviewAudio.duration);
            });

            const updateProgress = () => {
                if (currentReviewAudio && progressBar) {
                    const progress = (currentReviewAudio.currentTime / currentReviewAudio.duration) * 100;
                    progressBar.style.width = progress + '%';
                    currentTimeDisplay.textContent = formatTime(currentReviewAudio.currentTime);
                }
            };

            progressContainer.addEventListener('click', (e) => {
                if (!currentReviewAudio) return;
                const rect = progressContainer.getBoundingClientRect();
                const clickPosition = e.clientX - rect.left;
                const containerWidth = rect.width;
                const seekPercentage = Math.min(Math.max(clickPosition / containerWidth, 0), 1);
                currentReviewAudio.currentTime = seekPercentage * currentReviewAudio.duration;
                updateProgress();
            });

            currentReviewAudio.addEventListener('timeupdate', updateProgress);
            currentReviewAudio.addEventListener('ended', resetAudioPlayer);

            currentReviewAudio.onplay = () => {
                audioIcon.src = 'pause-icon.png';
                audioIcon.alt = 'Pause';
            };

            currentReviewAudio.onpause = () => {
                audioIcon.src = 'play-icon.png';
                audioIcon.alt = 'Play';
            };

            currentReviewAudio.play();
        }

        function resetAudioPlayer() {
            if (currentReviewAudioButton) {
                const icon = currentReviewAudioButton.querySelector('img');
                icon.src = 'play-icon.png';
                icon.alt = 'Play';
            }
            if (currentProgressContainer) {
                const progressBar = currentProgressContainer.querySelector('.progress-bar');
                if (progressBar) progressBar.style.width = '0%';
            }
            if (currentTimeDisplay) currentTimeDisplay.textContent = '0:00';
            currentReviewAudio = null;
            currentReviewAudioButton = null;
            currentProgressContainer = null;
            currentTimeDisplay = null;
            durationDisplay = null;
        }

        function stopAllReviewAudio() {
            if (currentReviewAudio) {
                currentReviewAudio.pause();
                resetAudioPlayer();
            }
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')} : ${seconds.toString().padStart(2, '0')}`;

            if (timeLeft <= 5 * 60 && !hasShownFiveMinuteWarning) {
                showTimeWarning();
                hasShownFiveMinuteWarning = true;
            }

            if (timeLeft < 5 * 60) {
                timerDisplay.style.color = '#f44336';
                timerDisplay.style.fontWeight = 'bold';
            }
        }

        function showTimeWarning() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background-color: white;
                color: black;
                padding: 15px 25px;
                border-radius: 5px;
                box-shadow: 0 6px 10px rgba(0,0,0,0.8);
                z-index: 100000;
                animation: fadeIn 0.5s;
            `;
            notification.textContent = 'Peringatan: Waktu tersisa 5 menit!';

            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; top: 0; }
                    to { opacity: 1; top: 20px; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; top: 20px; }
                    to { opacity: 0; top: 0; }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.5s';
                setTimeout(() => {
                    document.body.removeChild(notification);
                    document.head.removeChild(style);
                }, 500);
            }, 5000);
        }

        function timeUp() {
            clearInterval(timerInterval);

            const timeUpMessage = document.createElement('div');
            timeUpMessage.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.8);
                color: white;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 24px;
                z-index: 100000;
            `;
            timeUpMessage.textContent = 'Waktu sudah habis! Ujian akan dinilai sekarang';
            document.body.appendChild(timeUpMessage);

            setTimeout(() => {
                document.body.removeChild(timeUpMessage);
                showQuizResults();
            }, 2000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function calculateSectionScore(start, end) {
            let sectionScore = 0;
            for (let i = start; i <= end; i++) {
                if (userAnswers[i] && userAnswers[i] === correctAnswers[i]) {
                    sectionScore++;
                }
            }
            return sectionScore;
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadQuizData();
            loadAudioTranscripts();
        });
    </script>
</body>

</html>